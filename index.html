<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini IPTV - Ultra Fast</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        :root { --accent: #ffc107; --bg: #000; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        .player-box { background: #000; border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 1000; }
        .video-js { width: 100% !important; height: 210px !important; }
        
        /* Barra Amarela de Progresso */
        .progress-container { width: 100%; height: 8px; background: #222; }
        .progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .sidebar { position: fixed; left: -100%; top: 0; width: 80%; height: 100%; background: #111; z-index: 3000; transition: 0.3s; display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        .side-content { flex: 1; overflow-y: auto; padding: 10px; }
        .chan-item { padding: 15px; border-bottom: 1px solid #222; font-size: 14px; cursor: pointer; }

        .btn-menu { position: absolute; bottom: -50px; left: 15px; background: var(--accent); border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; display: none; }
        .welcome { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 60vh; text-align: center; padding: 20px; }
        input { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 8px; width: 85%; margin-bottom: 10px; }
        .sync-btn { background: var(--accent); border: none; padding: 15px 30px; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar" id="menu">
        <div style="padding: 20px; background: #000; border-bottom: 1px solid #222;">
            <button onclick="toggleMenu()" style="float: right; color: white; background: none; border: none; font-size: 20px;">‚úï</button>
            <h3 style="color: var(--accent); margin: 0;">CANAIS</h3>
        </div>
        <div class="side-content" id="lista"></div>
    </div>

    <div class="player-box">
        <video id="vid" class="video-js vjs-16-9 vjs-big-play-centered" controls playsinline></video>
        <div class="progress-container"><div class="progress-bar" id="bar"></div></div>
        <button class="btn-menu" id="m-btn" onclick="toggleMenu()">‚ò∞ ABRIR LISTA</button>
    </div>

    <div class="welcome" id="home">
        <div id="setup">
            <h2 style="color: var(--accent);">Gemini IPTV Pro</h2>
            <input type="text" id="url" placeholder="Cole seu link aqui...">
            <button class="sync-btn" onclick="startSync()">SINCRONIZAR AGORA</button>
        </div>
        <p id="msg" style="margin-top: 20px; color: var(--accent); display: none;">üì• Sincronizando...</p>
    </div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        const player = videojs('vid');
        function toggleMenu() { document.getElementById('menu').classList.toggle('active'); }

        async function startSync() {
            const link = document.getElementById('url').value.trim();
            if(!link) return;

            document.getElementById('setup').style.display = 'none';
            const msg = document.getElementById('msg');
            msg.style.display = 'block';
            const bar = document.getElementById('bar');

            try {
                const proxy = "https://api.allorigins.win/raw?url=";
                const res = await fetch(proxy + encodeURIComponent(link));
                const reader = res.body.getReader();
                let decoder = new TextDecoder();
                let fullText = '';
                let canais = [];

                while(true) {
                    const {done, value} = await reader.read();
                    if(done || canais.length >= 500) break; // LIMITADO A 500 PARA SER R√ÅPIDO

                    fullText += decoder.decode(value, {stream: true});
                    const lines = fullText.split('\n');
                    fullText = lines.pop();

                    for(let i=0; i<lines.length; i++) {
                        if(lines[i].includes('#EXTINF:')) {
                            const nome = lines[i].split(',').pop().trim();
                            const url = lines[i+1]?.trim();
                            if(url && url.startsWith('http')) {
                                canais.push({nome, url});
                                // Atualiza a barra amarela
                                bar.style.width = (canais.length / 5) + "%"; 
                            }
                        }
                    }
                }

                render(canais);
                bar.style.width = "100%";
                document.getElementById('m-btn').style.display = 'block';
                msg.innerText = "‚úÖ " + canais.length + " Canais Prontos!";
                setTimeout(toggleMenu, 1000);

            } catch(e) {
                msg.innerText = "‚ùå Erro. Resete as travas no painel.";
            }
        }

        function render(items) {
            const container = document.getElementById('lista');
            items.forEach(c => {
                const d = document.createElement('div');
                d.className = 'chan-item';
                d.innerHTML = "üì∫ " + c.nome;
                d.onclick = () => {
                    player.src({ src: c.url, type: 'application/x-mpegURL' });
                    player.play();
                    toggleMenu();
                };
                container.appendChild(d);
            });
        }
    </script>
</body>
</html>
